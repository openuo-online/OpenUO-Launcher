# å›½é™…åŒ– (i18n) ä½¿ç”¨æŒ‡å—

## æ¦‚è¿°

æœ¬é¡¹ç›®ä½¿ç”¨ `rust-i18n` å®ç°å›½é™…åŒ–æ”¯æŒã€‚

## æ”¯æŒçš„è¯­è¨€

- ğŸ‡¨ğŸ‡³ ç®€ä½“ä¸­æ–‡ (`zh-CN`) - é»˜è®¤
- ğŸ‡ºğŸ‡¸ English (`en`)

## ä½¿ç”¨æ–¹æ³•

### 1. åŸºæœ¬ç”¨æ³•

```rust
use crate::i18n::t;

// ç®€å•ç¿»è¯‘
let title = t!("window.title");

// å¸¦å‚æ•°çš„ç¿»è¯‘
let msg = t!("status.save_failed", error = "æ–‡ä»¶ä¸å­˜åœ¨");

// åœ¨ UI ä¸­ä½¿ç”¨
ui.label(t!("main.profile"));
ui.button(t!("main.edit"));
```

### 2. åœ¨ç°æœ‰ä»£ç ä¸­æ›¿æ¢

**ä¹‹å‰ï¼š**
```rust
ui.label("é…ç½®:");
ui.button("âœ ç¼–è¾‘");
```

**ä¹‹åï¼š**
```rust
use crate::i18n::t;

ui.label(t!("main.profile"));
ui.button(t!("main.edit"));
```

### 3. åˆ‡æ¢è¯­è¨€

```rust
use crate::i18n;

// åˆ‡æ¢åˆ°è‹±æ–‡
i18n::set_locale("en");

// åˆ‡æ¢åˆ°ä¸­æ–‡
i18n::set_locale("zh-CN");

// è·å–å½“å‰è¯­è¨€
let current = i18n::current_locale();
```

## ç¿»è¯‘æ–‡ä»¶ç»“æ„

```
locales/
â”œâ”€â”€ zh-CN.yml    # ç®€ä½“ä¸­æ–‡
â””â”€â”€ en.yml       # è‹±æ–‡
```

### æ·»åŠ æ–°ç¿»è¯‘

1. åœ¨ `locales/zh-CN.yml` ä¸­æ·»åŠ ä¸­æ–‡ï¼š
```yaml
my_feature:
  button: "æˆ‘çš„æŒ‰é’®"
  message: "æ¬¢è¿ %{name}"
```

2. åœ¨ `locales/en.yml` ä¸­æ·»åŠ è‹±æ–‡ï¼š
```yaml
my_feature:
  button: "My Button"
  message: "Welcome %{name}"
```

3. åœ¨ä»£ç ä¸­ä½¿ç”¨ï¼š
```rust
t!("my_feature.button")
t!("my_feature.message", name = "Alice")
```

## è‡ªåŠ¨è¯­è¨€æ£€æµ‹

ç¨‹åºå¯åŠ¨æ—¶ä¼šè‡ªåŠ¨æ£€æµ‹ç³»ç»Ÿè¯­è¨€ï¼š
- Windows: è¯»å–ç³»ç»ŸåŒºåŸŸè®¾ç½®
- macOS: è¯»å–ç³»ç»Ÿåå¥½è®¾ç½®
- Linux: è¯»å– `LANG` ç¯å¢ƒå˜é‡

æ£€æµ‹é€»è¾‘ï¼š
- `zh-*` â†’ ä½¿ç”¨ `zh-CN`
- å…¶ä»– â†’ ä½¿ç”¨ `en`

## æ·»åŠ æ–°è¯­è¨€

### 1. åˆ›å»ºç¿»è¯‘æ–‡ä»¶

```bash
cp locales/en.yml locales/ja.yml
# ç¼–è¾‘ ja.ymlï¼Œç¿»è¯‘æˆæ—¥æ–‡
```

### 2. æ›´æ–°è¯­è¨€æ£€æµ‹é€»è¾‘

ç¼–è¾‘ `src/i18n.rs`ï¼š

```rust
pub fn init_locale() {
    let system_locale = sys_locale::get_locale().unwrap_or_else(|| "en".to_string());
    
    let locale = if system_locale.starts_with("zh") {
        "zh-CN"
    } else if system_locale.starts_with("ja") {
        "ja"  // æ–°å¢æ—¥æ–‡æ”¯æŒ
    } else {
        "en"
    };
    
    set_locale(locale);
}
```

## æœ€ä½³å®è·µ

### âœ… æ¨è

```rust
// ä½¿ç”¨è¯­ä¹‰åŒ–çš„é”®å
t!("profile_editor.title")
t!("status.config_saved")

// å‚æ•°ä½¿ç”¨æœ‰æ„ä¹‰çš„åç§°
t!("status.save_failed", error = err_msg)
```

### âŒ ä¸æ¨è

```rust
// ä¸è¦ä½¿ç”¨æ•°å­—æˆ–æ— æ„ä¹‰çš„é”®å
t!("msg1")
t!("text_123")

// ä¸è¦ç¡¬ç¼–ç æ–‡æœ¬
ui.label("é…ç½®:");  // åº”è¯¥ä½¿ç”¨ t!("main.profile")
```

## ç¼–è¯‘æ—¶æ£€æŸ¥

`rust-i18n` ä¼šåœ¨ç¼–è¯‘æ—¶æ£€æŸ¥ï¼š
- âœ… ç¿»è¯‘é”®æ˜¯å¦å­˜åœ¨
- âœ… å‚æ•°æ˜¯å¦åŒ¹é…
- âœ… YAML è¯­æ³•æ˜¯å¦æ­£ç¡®

å¦‚æœç¿»è¯‘ç¼ºå¤±ï¼Œç¼–è¯‘ä¼šå¤±è´¥å¹¶æç¤ºé”™è¯¯ã€‚

## æ€§èƒ½

- **é›¶è¿è¡Œæ—¶å¼€é”€**ï¼šæ‰€æœ‰ç¿»è¯‘åœ¨ç¼–è¯‘æ—¶åµŒå…¥
- **æ— éœ€æ–‡ä»¶ I/O**ï¼šç¿»è¯‘ç›´æ¥ç¼–è¯‘åˆ°äºŒè¿›åˆ¶
- **å¿«é€ŸæŸ¥æ‰¾**ï¼šä½¿ç”¨ HashMapï¼ŒO(1) æŸ¥æ‰¾

## ç¤ºä¾‹ï¼šå®Œæ•´çš„ UI ç»„ä»¶

```rust
use crate::i18n::t;

fn show_profile_selector(&mut self, ui: &mut egui::Ui) {
    ui.horizontal(|ui| {
        ui.label(t!("main.profile"));
        
        // ... ComboBox ...
        
        if ui.button(t!("main.edit")).clicked() {
            self.open_profile_editor();
        }
        
        if ui.button(t!("main.new")).clicked() {
            self.add_profile();
        }
    });
}
```

## è°ƒè¯•

æŸ¥çœ‹å½“å‰ä½¿ç”¨çš„è¯­è¨€ï¼š

```bash
# è®¾ç½®æ—¥å¿—çº§åˆ«
RUST_LOG=info cargo run
```

è¾“å‡ºç¤ºä¾‹ï¼š
```
ç³»ç»Ÿè¯­è¨€: zh-CN, ä½¿ç”¨è¯­è¨€: zh-CN
```

## å‚è€ƒèµ„æ–™

- [rust-i18n æ–‡æ¡£](https://github.com/longbridgeapp/rust-i18n)
- [YAML è¯­æ³•](https://yaml.org/)
- [ICU MessageFormat](http://userguide.icu-project.org/formatparse/messages)
